<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4450px" preserveAspectRatio="none" style="width:6825px;height:4450px;background:#777777;" version="1.1" viewBox="0 0 6825 4450" width="6825px" zoomAndPan="magnify"><defs/><g><!--MD5=[aee47e4adc368b23a2c75b05fcb7ca1e]
cluster routes--><polygon fill="#777777" points="68.75,757.8125,375,757.8125,396.875,894.4824,3400,894.4824,3400,2629.6875,68.75,2629.6875,68.75,757.8125" style="stroke: #000000; stroke-width: 4.6875;"/><line style="stroke: #000000; stroke-width: 4.6875;" x1="68.75" x2="396.875" y1="894.4824" y2="894.4824"/><text fill="#000000" font-family="sans-serif" font-size="93.75" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="287.5" x="81.25" y="861.3831">routes</text><!--MD5=[4a3ccfc974e672ae0e8d92f4973d30b9]
cluster card.js--><rect fill="#2F4F4F" height="1596.875" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="3181.25" x="143.75" y="957.8125"/><rect fill="#2F4F4F" height="31.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="46.875" x="3262.5" y="973.4375"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="3256.25" y="979.6875"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="3256.25" y="992.1875"/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="359.375" x="1554.6875" y="1092.691">card.js</text><!--MD5=[a60570e4b426f702ccbb0d459e3b9417]
cluster models--><polygon fill="#777777" points="3475,581.25,3818.75,581.25,3840.625,717.9199,6756.25,717.9199,6756.25,4146.875,3475,4146.875,3475,581.25" style="stroke: #000000; stroke-width: 4.6875;"/><line style="stroke: #000000; stroke-width: 4.6875;" x1="3475" x2="3840.625" y1="717.9199" y2="717.9199"/><text fill="#000000" font-family="sans-serif" font-size="93.75" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="325" x="3487.5" y="684.8206">models</text><!--MD5=[a01365a80097baccedfc2f1852929a97]
cluster user.js--><rect fill="#2F4F4F" height="1950" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="3131.25" x="3550" y="781.25"/><rect fill="#2F4F4F" height="31.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="46.875" x="6618.75" y="796.875"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="6612.5" y="803.125"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="6612.5" y="815.625"/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="359.375" x="4935.9375" y="916.1285">user.js</text><!--MD5=[2dc90687bafe027e9cd205ba7247115e]
cluster course.js--><rect fill="#2F4F4F" height="1125" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="2000" x="4115.625" y="2946.875"/><rect fill="#2F4F4F" height="31.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="46.875" x="6053.125" y="2962.5"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="6046.875" y="2968.75"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="6046.875" y="2981.25"/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="481.25" x="4875" y="3081.7535">course.js</text><!--MD5=[e2a75efa8a0f57c2afae8bf75386f79c]
cluster views--><polygon fill="#777777" points="1415.625,75,1696.875,75,1718.75,211.6699,2053.125,211.6699,2053.125,506.25,1415.625,506.25,1415.625,75" style="stroke: #000000; stroke-width: 4.6875;"/><line style="stroke: #000000; stroke-width: 4.6875;" x1="1415.625" x2="1718.75" y1="211.6699" y2="211.6699"/><text fill="#000000" font-family="sans-serif" font-size="93.75" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="262.5" x="1428.125" y="178.5706">views</text><!--MD5=[24e2ffe3fe14b147bf8fee69b9d55bef]
cluster middleware--><polygon fill="#777777" points="718.75,2806.25,1256.25,2806.25,1278.125,2942.9199,2750,2942.9199,2750,4087.5,718.75,4087.5,718.75,2806.25" style="stroke: #000000; stroke-width: 4.6875;"/><line style="stroke: #000000; stroke-width: 4.6875;" x1="718.75" x2="1278.125" y1="2942.9199" y2="2942.9199"/><text fill="#000000" font-family="sans-serif" font-size="93.75" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="518.75" x="731.25" y="2909.8206">middleware</text><!--MD5=[c53328ea4eaa0e42595c7b2d43f9ecd2]
cluster auth.js--><rect fill="#2F4F4F" height="1006.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="1881.25" x="793.75" y="3006.25"/><rect fill="#2F4F4F" height="31.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="46.875" x="2612.5" y="3021.875"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="2606.25" y="3028.125"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="2606.25" y="3040.625"/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="365.625" x="1551.5625" y="3141.1285">auth.js</text><!--MD5=[b99f2379b2614aa822a25e60eea00bbb]
class delete--><rect fill="#2E2E2E" height="1374.3866" id="delete" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="3078.125" x="195.3125" y="1129.6875"/><ellipse cx="1576.5625" cy="1202.2812" fill="#228811" rx="25" ry="25" style="stroke: #1B1B1B; stroke-width: 3.125;"/><path d="M1578.5645,1215.2695 Q1575.7813,1215.2695 1573.4131,1214.4394 Q1571.0449,1213.6093 1569.3359,1211.998 Q1567.6758,1210.3867 1566.7236,1207.9453 Q1565.7715,1205.5038 1565.7715,1202.33 Q1565.7715,1199.3515 1566.6748,1196.9345 Q1567.5781,1194.5175 1569.2871,1192.7597 Q1570.8984,1191.0995 1573.3154,1190.1962 Q1575.7324,1189.2929 1578.5645,1189.2929 Q1580.127,1189.2929 1581.3965,1189.4638 Q1582.666,1189.6347 1583.7402,1189.9277 Q1584.8633,1190.2695 1585.791,1190.6601 Q1586.7188,1191.0507 1587.4023,1191.3925 L1587.4023,1197.4472 L1586.6699,1197.4472 Q1586.1816,1197.0566 1585.4736,1196.4951 Q1584.7656,1195.9335 1583.8379,1195.3964 Q1582.9102,1194.8593 1581.8359,1194.4931 Q1580.7617,1194.1269 1579.541,1194.1269 Q1578.1738,1194.1269 1576.9531,1194.5419 Q1575.7324,1194.957 1574.707,1195.9824 Q1573.7305,1196.9101 1573.1201,1198.497 Q1572.5098,1200.0839 1572.5098,1202.33 Q1572.5098,1204.6738 1573.1689,1206.2607 Q1573.8281,1207.8476 1574.8047,1208.7265 Q1575.8301,1209.6542 1577.0996,1210.0449 Q1578.3691,1210.4355 1579.5898,1210.4355 Q1580.7617,1210.4355 1581.9092,1210.0937 Q1583.0566,1209.7519 1584.0332,1209.1171 Q1584.8633,1208.6777 1585.5713,1208.1161 Q1586.2793,1207.5546 1586.7188,1207.164 L1587.4023,1207.164 L1587.4023,1213.121 Q1586.4746,1213.5605 1585.6201,1213.9267 Q1584.7656,1214.2929 1583.7891,1214.537 Q1582.5684,1214.8788 1581.4941,1215.0742 Q1580.4199,1215.2695 1578.5645,1215.2695 Z "/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="293.75" x="1626.5625" y="1239.566">delete</text><line style="stroke: #1B1B1B; stroke-width: 4.6875;" x1="198.4375" x2="3270.3125" y1="1274.8749" y2="1274.8749"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="537.5" x="214.0625" y="1384.6954">const cart = {</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="350" x="214.0625" y="1502.6154">courses,</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="214.0625" y="1620.5353">};</text><line style="stroke: #1B1B1B; stroke-width: 4.6875;" x1="198.4375" x2="3270.3125" y1="1653.6346" y2="1653.6346"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="2159.375" x="214.0625" y="1763.4552">router.delete('/remove/:id', auth, async (req, res) =&gt; {</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1956.25" x="214.0625" y="1881.3751">await req.user.removeFromCart(req.params.id);</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="3040.625" x="214.0625" y="1999.295">const user = await req.user.populate('cart.items.courseId').execPopulate();</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1703.125" x="214.0625" y="2117.215">const courses = mapCartItems(user.cart);</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1234.375" x="214.0625" y="2235.1349">price: computePrice(courses),</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1059.375" x="214.0625" y="2353.0548">res.status(200).json(cart);</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="87.5" x="214.0625" y="2470.9747">});</text><!--MD5=[dbb8dcd2dfc4c61691c38c9b3ddd1be3]
class removeFromCart--><rect fill="#2E2E2E" height="1728.1464" id="removeFromCart" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="3028.125" x="3601.5625" y="953.125"/><ellipse cx="4706.25" cy="1025.7187" fill="#228811" rx="25" ry="25" style="stroke: #1B1B1B; stroke-width: 3.125;"/><path d="M4708.252,1038.707 Q4705.4688,1038.707 4703.1006,1037.8769 Q4700.7324,1037.0468 4699.0234,1035.4355 Q4697.3633,1033.8242 4696.4111,1031.3828 Q4695.459,1028.9413 4695.459,1025.7675 Q4695.459,1022.789 4696.3623,1020.372 Q4697.2656,1017.955 4698.9746,1016.1972 Q4700.5859,1014.537 4703.0029,1013.6337 Q4705.4199,1012.7304 4708.252,1012.7304 Q4709.8145,1012.7304 4711.084,1012.9013 Q4712.3535,1013.0722 4713.4277,1013.3652 Q4714.5508,1013.707 4715.4785,1014.0976 Q4716.4063,1014.4882 4717.0898,1014.83 L4717.0898,1020.8847 L4716.3574,1020.8847 Q4715.8691,1020.4941 4715.1611,1019.9326 Q4714.4531,1019.371 4713.5254,1018.8339 Q4712.5977,1018.2968 4711.5234,1017.9306 Q4710.4492,1017.5644 4709.2285,1017.5644 Q4707.8613,1017.5644 4706.6406,1017.9794 Q4705.4199,1018.3945 4704.3945,1019.4199 Q4703.418,1020.3476 4702.8076,1021.9345 Q4702.1973,1023.5214 4702.1973,1025.7675 Q4702.1973,1028.1113 4702.8564,1029.6982 Q4703.5156,1031.2851 4704.4922,1032.164 Q4705.5176,1033.0917 4706.7871,1033.4824 Q4708.0566,1033.873 4709.2773,1033.873 Q4710.4492,1033.873 4711.5967,1033.5312 Q4712.7441,1033.1894 4713.7207,1032.5546 Q4714.5508,1032.1152 4715.2588,1031.5536 Q4715.9668,1030.9921 4716.4063,1030.6015 L4717.0898,1030.6015 L4717.0898,1036.5585 Q4716.1621,1036.998 4715.3076,1037.3642 Q4714.4531,1037.7304 4713.4766,1037.9745 Q4712.2559,1038.3163 4711.1816,1038.5117 Q4710.1074,1038.707 4708.252,1038.707 Z "/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="796.875" x="4756.25" y="1063.0035">removeFromCart</text><line style="stroke: #1B1B1B; stroke-width: 4.6875;" x1="3604.6875" x2="6626.5625" y1="1098.3124" y2="1098.3124"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1171.875" x="3620.3125" y="1208.1329">let items = [...this.cart.items];</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="0" x="3645.3125" y="1326.0529"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="281.25" x="3620.3125" y="1443.9728">} else {</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="762.5" x="3620.3125" y="1561.8927">items[idx].count--;}</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="0" x="3645.3125" y="1679.8126"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="790.625" x="3620.3125" y="1797.7325">this.cart = { items };</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="3620.3125" y="1915.6525">};</text><line style="stroke: #1B1B1B; stroke-width: 4.6875;" x1="3604.6875" x2="6626.5625" y1="1948.7518" y2="1948.7518"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="2278.125" x="3620.3125" y="2058.5724">userSchema.methods.removeFromCart = function (id) {</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="2990.625" x="3620.3125" y="2176.4923">const idx = items.findIndex((c) =&gt; c.courseId.toString() === id.toString());</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="0" x="3645.3125" y="2294.4122"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1106.25" x="3620.3125" y="2412.3322">if (items[idx].count === 1) {</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="2618.75" x="3620.3125" y="2530.2521">items = items.filter((c) =&gt; c.courseId.toString() !== id.toString());</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="721.875" x="3620.3125" y="2648.172">return this.save();</text><!--MD5=[8a692311d5cb00c35df82747678352e2]
class toClient--><rect fill="#2E2E2E" height="902.7069" id="toClient" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="1896.875" x="4167.1875" y="3118.75"/><ellipse cx="4920.3125" cy="3191.3437" fill="#228811" rx="25" ry="25" style="stroke: #1B1B1B; stroke-width: 3.125;"/><path d="M4922.3145,3204.332 Q4919.5313,3204.332 4917.1631,3203.5019 Q4914.7949,3202.6718 4913.0859,3201.0605 Q4911.4258,3199.4492 4910.4736,3197.0078 Q4909.5215,3194.5663 4909.5215,3191.3925 Q4909.5215,3188.414 4910.4248,3185.997 Q4911.3281,3183.58 4913.0371,3181.8222 Q4914.6484,3180.162 4917.0654,3179.2587 Q4919.4824,3178.3554 4922.3145,3178.3554 Q4923.877,3178.3554 4925.1465,3178.5263 Q4926.416,3178.6972 4927.4902,3178.9902 Q4928.6133,3179.332 4929.541,3179.7226 Q4930.4688,3180.1132 4931.1523,3180.455 L4931.1523,3186.5097 L4930.4199,3186.5097 Q4929.9316,3186.1191 4929.2236,3185.5576 Q4928.5156,3184.996 4927.5879,3184.4589 Q4926.6602,3183.9218 4925.5859,3183.5556 Q4924.5117,3183.1894 4923.291,3183.1894 Q4921.9238,3183.1894 4920.7031,3183.6044 Q4919.4824,3184.0195 4918.457,3185.0449 Q4917.4805,3185.9726 4916.8701,3187.5595 Q4916.2598,3189.1464 4916.2598,3191.3925 Q4916.2598,3193.7363 4916.9189,3195.3232 Q4917.5781,3196.9101 4918.5547,3197.789 Q4919.5801,3198.7167 4920.8496,3199.1074 Q4922.1191,3199.498 4923.3398,3199.498 Q4924.5117,3199.498 4925.6592,3199.1562 Q4926.8066,3198.8144 4927.7832,3198.1796 Q4928.6133,3197.7402 4929.3213,3197.1786 Q4930.0293,3196.6171 4930.4688,3196.2265 L4931.1523,3196.2265 L4931.1523,3202.1835 Q4930.2246,3202.623 4929.3701,3202.9892 Q4928.5156,3203.3554 4927.5391,3203.5995 Q4926.3184,3203.9413 4925.2441,3204.1367 Q4924.1699,3204.332 4922.3145,3204.332 Z "/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="368.75" x="4970.3125" y="3228.6285">toClient</text><line style="stroke: #1B1B1B; stroke-width: 4.6875;" x1="4170.3125" x2="6060.9375" y1="3263.9374" y2="3263.9374"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="940.625" x="4185.9375" y="3373.7579">course.id = course._id;</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="731.25" x="4185.9375" y="3491.6779">delete course._id;</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="571.875" x="4185.9375" y="3609.5978">return course;</text><line style="stroke: #1B1B1B; stroke-width: 4.6875;" x1="4170.3125" x2="6060.9375" y1="3642.6971" y2="3642.6971"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1859.375" x="4185.9375" y="3752.5177">courseSchema.method('toClient', function () {</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1234.375" x="4185.9375" y="3870.4376">const course = this.toObject();</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="87.5" x="4185.9375" y="3988.3575">});</text><!--MD5=[187785f41a07d68efacd6bd60a429822]
entity card.hbs--><rect fill="#2F4F4F" height="207.6874" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="534.375" x="1467.1875" y="250"/><rect fill="#2F4F4F" height="31.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="46.875" x="1939.0625" y="265.625"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="1932.8125" y="271.875"/><rect fill="#2F4F4F" height="6.25" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="12.5" x="1932.8125" y="284.375"/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="409.375" x="1514.0625" y="406.7535">card.hbs</text><!--MD5=[bda47d503442ff4a0d0fa4aec41fe8fa]
class isAuthenticated--><rect fill="#2E2E2E" height="784.787" id="isAuthenticated" style="stroke: #1B1B1B; stroke-width: 4.6875;" width="1781.25" x="843.75" y="3178.125"/><ellipse cx="1353.125" cy="3250.7187" fill="#228811" rx="25" ry="25" style="stroke: #1B1B1B; stroke-width: 3.125;"/><path d="M1355.127,3263.707 Q1352.3438,3263.707 1349.9756,3262.8769 Q1347.6074,3262.0468 1345.8984,3260.4355 Q1344.2383,3258.8242 1343.2861,3256.3828 Q1342.334,3253.9413 1342.334,3250.7675 Q1342.334,3247.789 1343.2373,3245.372 Q1344.1406,3242.955 1345.8496,3241.1972 Q1347.4609,3239.537 1349.8779,3238.6337 Q1352.2949,3237.7304 1355.127,3237.7304 Q1356.6895,3237.7304 1357.959,3237.9013 Q1359.2285,3238.0722 1360.3027,3238.3652 Q1361.4258,3238.707 1362.3535,3239.0976 Q1363.2813,3239.4882 1363.9648,3239.83 L1363.9648,3245.8847 L1363.2324,3245.8847 Q1362.7441,3245.4941 1362.0361,3244.9326 Q1361.3281,3244.371 1360.4004,3243.8339 Q1359.4727,3243.2968 1358.3984,3242.9306 Q1357.3242,3242.5644 1356.1035,3242.5644 Q1354.7363,3242.5644 1353.5156,3242.9794 Q1352.2949,3243.3945 1351.2695,3244.4199 Q1350.293,3245.3476 1349.6826,3246.9345 Q1349.0723,3248.5214 1349.0723,3250.7675 Q1349.0723,3253.1113 1349.7314,3254.6982 Q1350.3906,3256.2851 1351.3672,3257.164 Q1352.3926,3258.0917 1353.6621,3258.4824 Q1354.9316,3258.873 1356.1523,3258.873 Q1357.3242,3258.873 1358.4717,3258.5312 Q1359.6191,3258.1894 1360.5957,3257.5546 Q1361.4258,3257.1152 1362.1338,3256.5536 Q1362.8418,3255.9921 1363.2813,3255.6015 L1363.9648,3255.6015 L1363.9648,3261.5585 Q1363.0371,3261.998 1362.1826,3262.3642 Q1361.3281,3262.7304 1360.3516,3262.9745 Q1359.1309,3263.3163 1358.0566,3263.5117 Q1356.9824,3263.707 1355.127,3263.707 Z "/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="740.625" x="1403.125" y="3288.0035">isAuthenticated</text><line style="stroke: #1B1B1B; stroke-width: 4.6875;" x1="846.875" x2="2621.875" y1="3323.3124" y2="3323.3124"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="56.25" x="862.5" y="3433.1329">};</text><line style="stroke: #1B1B1B; stroke-width: 4.6875;" x1="846.875" x2="2621.875" y1="3466.2323" y2="3466.2323"/><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1743.75" x="862.5" y="3576.0529">module.exports = function (req, res, next) {</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1353.125" x="862.5" y="3693.9728">if (!req.session.isAuthenticated) {</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="1318.75" x="862.5" y="3811.8927">return res.redirect('/auth/login');}</text><text fill="#AAAAAA" font-family="sans-serif" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="259.375" x="862.5" y="3929.8126">next();</text><!--MD5=[ba72416187da2a396e219ea5b5d73a26]
entity MongoDB--><path d="M4860.9375,4240.625 C4860.9375,4209.375 5115.625,4209.375 5115.625,4209.375 C5115.625,4209.375 5370.3125,4209.375 5370.3125,4240.625 L5370.3125,4382.6874 C5370.3125,4413.9374 5115.625,4413.9374 5115.625,4413.9374 C5115.625,4413.9374 4860.9375,4413.9374 4860.9375,4382.6874 L4860.9375,4240.625 " fill="#2E2E2E" style="stroke: #1B1B1B; stroke-width: 4.6875;"/><path d="M4860.9375,4240.625 C4860.9375,4271.875 5115.625,4271.875 5115.625,4271.875 C5115.625,4271.875 5370.3125,4271.875 5370.3125,4240.625 " fill="none" style="stroke: #1B1B1B; stroke-width: 4.6875;"/><text fill="#FFFFFF" font-family="Verdana" font-size="93.75" lengthAdjust="spacingAndGlyphs" textLength="446.875" x="4892.1875" y="4378.6285">MongoDB</text><!--MD5=[2d6aebd7a3400340ca70550edab2bb66]
link card.hbs to delete--><path d="M1734.375,472.6875 C1734.375,614.5313 1734.375,865.9375 1734.375,1113.0625 " fill="none" id="card.hbs-delete" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="1734.375,1129.3125,1746.875,1101.1875,1734.375,1113.6875,1721.875,1101.1875,1734.375,1129.3125" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="1734.375,456.4375,1721.875,484.5625,1734.375,472.0625,1746.875,484.5625,1734.375,456.4375" style="stroke: #FFFFFF; stroke-width: 3.125;"/><!--MD5=[48093ccc2eb3e72f1b6438820a774f5c]
link delete to removeFromCart--><path d="M3290.5625,1817.1875 C3388.875,1817.1875 3487.1875,1817.1875 3585.5,1817.1875 " fill="none" id="delete-removeFromCart" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="3601.25,1817.1875,3573.125,1804.6875,3585.625,1817.1875,3573.125,1829.6875,3601.25,1817.1875" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="3273.9375,1817.1875,3302.0625,1829.6875,3289.5625,1817.1875,3302.0625,1804.6875,3273.9375,1817.1875" style="stroke: #FFFFFF; stroke-width: 3.125;"/><!--MD5=[f2e85379c487352dccabe86f8e371edb]
link delete to isAuthenticated--><path d="M1734.375,2521.7688 C1734.375,2739.0719 1734.375,2971.1656 1734.375,3161.3281 " fill="none" id="delete-isAuthenticated" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="1734.375,3177.2656,1746.875,3149.1406,1734.375,3161.6406,1721.875,3149.1406,1734.375,3177.2656" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="1734.375,2505.7094,1721.875,2533.8344,1734.375,2521.3344,1746.875,2533.8344,1734.375,2505.7094" style="stroke: #FFFFFF; stroke-width: 3.125;"/><!--MD5=[5865c7275612c19a1ceb6b8f517995de]
link removeFromCart to toClient--><path d="M5115.625,2698.1625 C5115.625,2837.6031 5115.625,2976.8906 5115.625,3101.8156 " fill="none" id="removeFromCart-toClient" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="5115.625,3118.5563,5128.125,3090.4313,5115.625,3102.9313,5103.125,3090.4313,5115.625,3118.5563" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="5115.625,2682.2344,5103.125,2710.3594,5115.625,2697.8594,5128.125,2710.3594,5115.625,2682.2344" style="stroke: #FFFFFF; stroke-width: 3.125;"/><!--MD5=[07798fd0e12a149cbe5e5a05efa72e97]
link toClient to MongoDB--><path d="M5115.625,4039.0813 C5115.625,4095.7031 5115.625,4148.9491 5115.625,4192.875 " fill="none" id="toClient-MongoDB" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="5115.625,4208.6253,5128.125,4180.5003,5115.625,4193.0003,5103.125,4180.5003,5115.625,4208.6253" style="stroke: #FFFFFF; stroke-width: 3.125;"/><polygon fill="#FFFFFF" points="5115.625,4022.8344,5103.125,4050.9594,5115.625,4038.4594,5128.125,4050.9594,5115.625,4022.8344" style="stroke: #FFFFFF; stroke-width: 3.125;"/><!--MD5=[b46566ce727353e10d32cee8453beb98]
@startuml
!define DARKGREEN
!includeurl https://raw.githubusercontent.com/Drakemor/RedDress-PlantUML/master/style.puml

skinparam {
      Shadowing false
    Dpi 300
  ClassAttributeFontSize 30
  ClassFontSize 30
  ComponentFontSize 30
  PackageFontSize 30
  DatabaseFontSize 30
  ComponentBackgroundColor DarkSlateGrey
}

package routes{
    component card.js{
        class delete{
 router.delete('/remove/:id', auth, async (req, res) => {
  await req.user.removeFromCart(req.params.id);
  const user = await req.user.populate('cart.items.courseId').execPopulate();
  const courses = mapCartItems(user.cart);
  const cart = {
    courses,
    price: computePrice(courses),
  };
  res.status(200).json(cart);
});
        }
    }
}

package models{
    component user.js{
        class removeFromCart{
            userSchema.methods.removeFromCart = function (id) {
  let items = [...this.cart.items];
  const idx = items.findIndex((c) => c.courseId.toString() === id.toString());

  if (items[idx].count === 1) {
    items = items.filter((c) => c.courseId.toString() !== id.toString());
  } else {
    items[idx].count- -;}

  this.cart = { items };
  return this.save();
};

        }
    }
    component course.js{
        class toClient{
 courseSchema.method('toClient', function () {
  const course = this.toObject();
  course.id = course._id;
  delete course._id;
  return course;
});
        }
    }
}

package views{
    component card.hbs{

    }
}

package middleware{
    component auth.js{
        class isAuthenticated{
  module.exports = function (req, res, next) {
  if (!req.session.isAuthenticated) {
    return res.redirect('/auth/login');}
  next();
};
        }
    }
}
database MongoDB{

}

card.hbs <- -> delete
delete <-right-> removeFromCart
isAuthenticated <-up-> delete
removeFromCart <- -> toClient
toClient <- -> MongoDB

@enduml

@startuml







skinparam stereotypeCBackgroundColor 228811





skinparam backgroundColor 777







skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Verdana
}

skinparam class {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
    arrowColor fff
  arrowFontName Verdana
  arrowFontColor bbb
  arrowFontSize 11

  attributeFontColor aaa
  attributeFontSize 11
  attributeIconSize 11
}


skinparam actor {
    backgroundColor 228811
  borderColor 113300
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor 575757
  borderColor 767676
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}


skinparam interface {
    backgroundColor 228811
  borderColor 113300
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam node {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam database {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam queue {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
    arrowColor fff
  arrowFontName Verdana
  arrowFontColor bbb
  arrowFontSize 11
}

skinparam activity {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
    arrowColor fff
  arrowFontName Verdana
  arrowFontColor bbb
  arrowFontSize 11
}

skinparam sequence {
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
    arrowColor fff
  arrowFontName Verdana
  arrowFontColor bbb
  arrowFontSize 11

  lifeLineBorderColor 228811
  lifeLineBackgroundColor 575757
}

skinparam boundary {
    backgroundColor 228811
  borderColor 113300
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam control {
    backgroundColor 228811
  borderColor 113300
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam entity {
    backgroundColor 228811
  borderColor 113300
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}


skinparam state {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
    arrowColor fff
  arrowFontName Verdana
  arrowFontColor bbb
  arrowFontSize 11
  startColor 228811
  endColor 113300
}


skinparam object {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
    arrowColor fff
  arrowFontName Verdana
  arrowFontColor bbb
  arrowFontSize 11
}


skinparam note {
    backgroundColor 228811
  borderColor 113300
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam cloud {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
    arrowColor fff
  arrowFontName Verdana
  arrowFontColor bbb
  arrowFontSize 11
}

skinparam rectangle {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}

skinparam storage {
    backgroundColor 2e2e2e
  borderColor 1b1b1b
    fontColor fff
  fontName Verdana
  fontSize 11
  stereotypeFontColor aaa
  stereotypeFontSize 11
}


skinparam {
      Shadowing false
    Dpi 300
  ClassAttributeFontSize 30
  ClassFontSize 30
  ComponentFontSize 30
  PackageFontSize 30
  DatabaseFontSize 30
  ComponentBackgroundColor DarkSlateGrey
}

package routes{
    component card.js{
        class delete{
 router.delete('/remove/:id', auth, async (req, res) => {
  await req.user.removeFromCart(req.params.id);
  const user = await req.user.populate('cart.items.courseId').execPopulate();
  const courses = mapCartItems(user.cart);
  const cart = {
    courses,
    price: computePrice(courses),
  };
  res.status(200).json(cart);
});
        }
    }
}

package models{
    component user.js{
        class removeFromCart{
            userSchema.methods.removeFromCart = function (id) {
  let items = [...this.cart.items];
  const idx = items.findIndex((c) => c.courseId.toString() === id.toString());

  if (items[idx].count === 1) {
    items = items.filter((c) => c.courseId.toString() !== id.toString());
  } else {
    items[idx].count- -;}

  this.cart = { items };
  return this.save();
};

        }
    }
    component course.js{
        class toClient{
 courseSchema.method('toClient', function () {
  const course = this.toObject();
  course.id = course._id;
  delete course._id;
  return course;
});
        }
    }
}

package views{
    component card.hbs{

    }
}

package middleware{
    component auth.js{
        class isAuthenticated{
  module.exports = function (req, res, next) {
  if (!req.session.isAuthenticated) {
    return res.redirect('/auth/login');}
  next();
};
        }
    }
}
database MongoDB{

}

card.hbs <- -> delete
delete <-right-> removeFromCart
isAuthenticated <-up-> delete
removeFromCart <- -> toClient
toClient <- -> MongoDB

@enduml

PlantUML version 1.2020.10(Sun May 17 12:35:57 MSK 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_241-b07
Operating System: Windows 10
Default Encoding: Cp1251
Language: ru
Country: RU
--></g></svg>